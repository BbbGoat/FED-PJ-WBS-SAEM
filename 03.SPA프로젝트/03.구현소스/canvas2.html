<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>캔버스로 공튀기기2</title>
    <style>
        canvas { border: 1px solid black; }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="800" height="500"></canvas>
    <script>
      window.onload = function () {
        // 스크립트 로딩이 완료된 후부터 내용을 시작

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 800;
        canvas.height = 500;

        balls=[];
        ballNumber = 50;
        
        // 상태이용값
        let running = false;

                
        class Ball{
            constructor(x,y){ // ball의 기본 속성들을 정의 
                this.x = x;
                this.y = y;
                this.c = 'rgba('+Math.random()*255+','+Math.random()*255+','+Math.random()*255+')';
                this.size = Math.random()*10+5;
                this.angle = (Math.random()*360)*((Math.PI*2)/360);
                this.power = Math.random()*3+2;
                this.directionX = this.power * Math.cos(this.angle);
                this.weight = this.power * Math.sin(this.angle);
            }
            update(){ // 프레임마다 속성들을 변화시킴 
                this.y += this.weight; 
                this.x += this.directionX;
                this.weight += 0.1; // 프레임마다 떨어질때의 가속도 증가
                this.directionX *= 0.997; // 가로방향 속도 감소. 
                if(this.y+this.size>canvas.height || this.y-this.size<0){ // 세로 방향 바운드 처리
                    this.weight *= -0.8; // y 방향을 바꿔주면서 점차 바운스가 감소하게
                    if(Math.abs(this.weight)<0.9){this.y = canvas.height-this.size; // 바운드가 어느 정도 이하가 되면 더 이상 바운드 안하게, 즉, 바닥에 붙게 한다.
                    this.weight =1;} else { this.y -=1 ;} // 
                    };
                if(this.x>canvas.width-this.size || this.x-this.size < 0 ) { // 가로 방향 바운드 처리 
                    this.directionX *= -1; // x 방향 전환.  
                } 
            }
            draw(){ // 넘어온 속성값대로 캔버스에 그림을 그려줌
                ctx.fillStyle= this.c;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2, true);
                ctx.closePath();
                ctx.fill();
                ctx.strokeStyle = 'black';
                ctx.strokeWidth = 4;
                ctx.stroke();
            }
        }

        function init() {
          // 그려질 공의 초기 좌표 설정
          ball1 = new Ball(canvas.width * 0.5, canvas.height * 0.5);
        }

        ball1 = new Ball();



        function animate() {
          // 매 프레임마다 벌어지는 일들
          ctx.fillStyle = "rgba(255,255,255)";
          ctx.fillRect(0, 0, canvas.width, canvas.height); // 캔버스 전체를 색칠해서 내용을 지워준다
          ball1.update(); // ball1의 좌표 등을 업데이트 한다
          ball1.draw(); // 업데이트된 내용으로 ball을 새로 그린다.
          requestAnimationFrame(animate);
        }


        canvas.addEventListener('mousemove', function(e){
            //running이 false 일때 
            if(!running){
                //새롭게 그린다.
                // animate();

                //x,y는 마우스가 움직이는 대로 변경된다. 상수는 마우스가 중간에 오도록 조절한 것이다.
                ball1.x = e.clientX;
                ball1.y = e.clientY;
                console.log(ball1.x, ball1.y)

                // 원을 새롭게 그린다. 
                // ball1.blueprint();
                ball1.update(); // ball1의 좌표 등을 업데이트 한다
                ball1.draw(); // 업데이트된 내용으로 ball을 새로 그린다.
            }
        })
        canvas.addEventListener('click', function(e){
            if(!running){
                //클릭하면 애니메이션을 그리고 running을 true로 만들어 mouseover 이벤트가 동작하지 않도록 한다.
                animate();
                ball1.update();
                ball1.draw();
                init();
                requestAnimationFrame(animate);
            }
        })
        

        animate(); // 프레임마다 공을 그려준다.


      };
    </script>
  </body>
</html>
